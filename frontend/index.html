<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ACE-Step Wrangler</title>
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="app">

  <!-- ===== Header ===== -->
  <header id="header">
    <div class="logo">
      <span class="logo-icon">♪</span>
      <span class="logo-text">ACE-Step <span class="logo-accent">Wrangler</span></span>
    </div>
    <div class="mode-selector" role="tablist" aria-label="Task mode">
      <button class="mode-btn active" data-mode="create" role="tab" aria-selected="true">Create</button>
      <button class="mode-btn" data-mode="rework" role="tab" aria-selected="false">Rework</button>
    </div>
    <button class="icon-btn" id="settings-btn" aria-label="Settings" title="Settings">⚙</button>
  </header>

  <!-- ===== Main Three-Column Layout ===== -->
  <main id="main">

    <!-- Left column -->
    <section class="panel" id="left-column">

      <!-- Create mode panel -->
      <div id="create-panel" class="mode-panel">
        <h2 class="panel-title">Style</h2>

        <!-- Genre tags -->
        <div class="tag-section">
          <span class="tag-group-label">Genre</span>
          <div class="tag-grid">
            <button class="tag">Electronic</button>
            <button class="tag">Hip-Hop</button>
            <button class="tag">Jazz</button>
            <button class="tag">Rock</button>
            <button class="tag">Classical</button>
            <button class="tag">Ambient</button>
            <button class="tag">Pop</button>
            <button class="tag">R&amp;B</button>
            <button class="tag">Folk</button>
            <button class="tag">Metal</button>
            <button class="tag">Latin</button>
            <button class="tag">Blues</button>
            <button class="tag">Country</button>
            <button class="tag">Reggae</button>
            <button class="tag">Soul</button>
            <button class="tag">Funk</button>
          </div>
        </div>

        <!-- Mood tags -->
        <div class="tag-section">
          <span class="tag-group-label">Mood</span>
          <div class="tag-grid">
            <button class="tag">Uplifting</button>
            <button class="tag">Melancholic</button>
            <button class="tag">Energetic</button>
            <button class="tag">Chill</button>
            <button class="tag">Dark</button>
            <button class="tag">Dreamy</button>
            <button class="tag">Intense</button>
            <button class="tag">Romantic</button>
            <button class="tag">Nostalgic</button>
            <button class="tag">Aggressive</button>
          </div>
        </div>

        <!-- Tag selection status -->
        <div class="tags-status hidden" id="tags-status">
          <span class="tags-count" id="tags-count">1 selected</span>
          <button class="ghost-btn" id="clear-tags-btn">Clear all</button>
        </div>

        <!-- Song Parameters -->
        <div class="song-params">
          <span class="tag-group-label">Song Parameters</span>

          <div class="key-inputs">
            <select id="key-root" class="select-input select-narrow" aria-label="Key root">
              <option value="">Key</option>
              <option value="C">C</option>
              <option value="C#">C#</option>
              <option value="D">D</option>
              <option value="D#">D#</option>
              <option value="E">E</option>
              <option value="F">F</option>
              <option value="F#">F#</option>
              <option value="G">G</option>
              <option value="G#">G#</option>
              <option value="A">A</option>
              <option value="A#">A#</option>
              <option value="B">B</option>
            </select>
            <select id="key-mode" class="select-input" aria-label="Key mode">
              <option value="major">Major</option>
              <option value="minor">Minor</option>
            </select>
          </div>

          <div class="song-param-grid">
            <input type="number" id="bpm" class="number-input" min="40" max="300" step="1" placeholder="BPM" autocomplete="off" aria-label="BPM">
            <select id="time-sig" class="select-input">
              <option value="4/4" selected>4/4</option>
              <option value="3/4">3/4</option>
              <option value="6/8">6/8</option>
              <option value="5/4">5/4</option>
              <option value="7/8">7/8</option>
            </select>
          </div>
        </div>

        <div class="section-divider"></div>

        <!-- Free text override -->
        <div class="field-group">
          <label class="field-label" for="style-text">Custom description</label>
          <textarea
            id="style-text"
            class="text-input"
            placeholder="Describe your sound… e.g. dreamy lo-fi with warm bass and vinyl crackle"
            rows="4"
          ></textarea>
        </div>

        <!-- Style preview -->
        <div class="style-preview" id="style-preview">
          <span class="style-preview-label">Style prompt</span>
          <span class="style-preview-text empty" id="style-preview-text">Nothing set — add tags or a description</span>
        </div>
      </div>

      <!-- Rework mode panel -->
      <div id="rework-panel" class="mode-panel hidden">
        <h2 class="panel-title">Rework</h2>

        <!-- Audio upload zone -->
        <div class="audio-upload-zone" id="audio-upload-zone">
          <div class="upload-prompt" id="upload-prompt">
            <span class="upload-icon">♫</span>
            <span class="upload-label">Drop audio here or</span>
            <button class="ghost-btn" id="browse-audio-btn" type="button">Browse</button>
          </div>
          <div class="upload-loaded hidden" id="upload-loaded">
            <div class="upload-file-info">
              <span class="upload-filename" id="upload-filename"></span>
              <span class="upload-duration" id="upload-duration"></span>
            </div>
            <audio id="audio-preview" controls></audio>
            <button class="ghost-btn" id="remove-audio-btn" type="button">Remove</button>
          </div>
        </div>

        <div class="section-divider"></div>

        <!-- Approach selector -->
        <span class="tag-group-label">Approach</span>
        <div class="approach-grid">
          <button class="approach-btn active" data-approach="cover">
            <span class="approach-name">Reimagine</span>
            <span class="approach-desc">New take on the same song</span>
          </button>
          <button class="approach-btn" data-approach="repaint">
            <span class="approach-name">Fix &amp; Blend</span>
            <span class="approach-desc">Fix a section, keep the rest</span>
          </button>
        </div>

        <!-- Cover strength (Reimagine only) -->
        <div class="control-group" id="cover-strength-group">
          <div class="control-label-row">
            <label class="field-label" for="cover-strength">Cover strength</label>
            <span class="control-value" id="cover-strength-value">50%</span>
          </div>
          <input type="range" id="cover-strength" class="slider" min="0" max="100" value="50" step="1">
          <div class="slider-bounds"><span>Subtle</span><span>Dramatic</span></div>
        </div>

        <!-- Region selection (Fix & Blend only) -->
        <div class="region-inputs hidden" id="region-inputs">
          <span class="tag-group-label">Region to fix</span>
          <div class="region-grid">
            <div class="field-group">
              <label class="field-label" for="region-start">Start (s)</label>
              <input type="number" id="region-start" class="number-input" min="0" step="0.1" value="0" autocomplete="off">
            </div>
            <div class="field-group">
              <label class="field-label" for="region-end">End (s)</label>
              <input type="number" id="region-end" class="number-input" min="0" step="0.1" value="0" autocomplete="off">
            </div>
          </div>
          <p class="repaint-tip">Tip: Fix &amp; Blend works best on specific sections rather than the whole song</p>
        </div>

        <div class="section-divider"></div>

        <!-- Style direction -->
        <div class="field-group">
          <label class="field-label" for="rework-direction">Style direction</label>
          <textarea
            id="rework-direction"
            class="text-input"
            placeholder="Describe the desired result… e.g. make it more jazzy with brass"
            rows="3"
          ></textarea>
        </div>
      </div>

    </section>

    <!-- Center: Lyrics -->
    <section class="panel" id="lyrics-panel">
      <div class="panel-header">
        <h2 class="panel-title">Lyrics</h2>
        <div class="lyrics-tabs" role="tablist">
          <button class="lyrics-tab active" data-tab="write" role="tab" aria-selected="true" aria-controls="lyrics-tab-write">Write</button>
          <button class="lyrics-tab" data-tab="generate" role="tab" aria-selected="false" aria-controls="lyrics-tab-generate">Generate</button>
        </div>
        <div class="panel-actions" id="write-tab-actions">
          <button class="ghost-btn" id="load-file-btn">Load file</button>
          <button class="ghost-btn" id="clear-btn">Clear</button>
        </div>
      </div>

      <!-- Write tab -->
      <div class="lyrics-tab-content" id="lyrics-tab-write" role="tabpanel">
        <textarea
          id="lyrics-text"
          class="text-input lyrics-area"
          placeholder="Type or paste your lyrics here…&#10;&#10;[Verse 1]&#10;Lines go here&#10;&#10;[Chorus]&#10;Lines go here"
          spellcheck="true"
        ></textarea>

        <div class="lyrics-meta">
          <span class="lyrics-count" id="lyrics-count">0 lines · 0 chars</span>
          <span class="lyrics-warning hidden" id="lyrics-warning" aria-live="polite">⚠ May be too long for selected duration</span>
        </div>
      </div>

      <!-- Generate tab -->
      <div class="lyrics-tab-content hidden" id="lyrics-tab-generate" role="tabpanel">
        <div class="field-group">
          <label class="field-label" for="lyrics-description">Describe the song you want</label>
          <textarea
            id="lyrics-description"
            class="text-input"
            placeholder="e.g. A melancholic ballad about lost love in a rainy city, with verses building to an emotional chorus"
            rows="4"
          ></textarea>
        </div>

        <div class="generate-lyrics-row">
          <select id="lyrics-language" class="select-input select-narrow-lang" aria-label="Language">
            <option value="en" selected>EN</option>
            <option value="zh">ZH</option>
            <option value="ja">JA</option>
            <option value="ko">KO</option>
          </select>
          <button class="generate-lyrics-btn" id="generate-lyrics-btn" type="button">Generate Lyrics</button>
        </div>

        <div class="lyrics-gen-status hidden" id="lyrics-gen-status">
          <div class="spinner spinner-sm"></div>
          <span>Generating lyrics (this includes a full generation)…</span>
        </div>

        <div class="lyrics-preview hidden" id="lyrics-preview">
          <div class="lyrics-preview-meta" id="lyrics-preview-meta"></div>
          <pre class="lyrics-preview-text" id="lyrics-preview-text"></pre>
          <div class="lyrics-preview-actions">
            <button class="ghost-btn" id="use-lyrics-btn" type="button">Use These Lyrics</button>
            <button class="ghost-btn use-lyrics-meta-btn" id="use-lyrics-meta-btn" type="button">Use Lyrics + Apply Metadata</button>
          </div>
        </div>

        <div class="generate-hint" id="lyrics-gen-hint" aria-live="assertive"></div>
      </div>
    </section>

    <!-- Right: Controls -->
    <section class="panel" id="controls-panel">
      <h2 class="panel-title">Controls</h2>

      <div class="control-group">
        <div class="control-label-row">
          <label class="field-label" for="duration">Duration</label>
          <div class="duration-right">
            <button class="auto-btn" id="auto-duration-btn" type="button" title="Compute duration from lyrics and tempo">Auto</button>
            <span class="control-value" id="duration-value">30s</span>
          </div>
        </div>
        <input type="range" id="duration" class="slider" min="10" max="600" value="30" step="5">
        <div class="slider-bounds"><span>10s</span><span>10 min</span></div>
      </div>

      <div class="section-divider"></div>

      <div class="control-group">
        <div class="control-label-row">
          <label class="field-label" for="lyric-adherence">Strictly follow lyrics</label>
          <span class="control-value" id="lyric-adherence-value">Med</span>
        </div>
        <input type="range" id="lyric-adherence" class="slider" min="0" max="2" value="1" step="1">
        <div class="slider-bounds"><span>Loose</span><span>Strict</span></div>
      </div>

      <div class="control-group">
        <div class="control-label-row">
          <label class="field-label" for="creativity">Creativity</label>
          <span class="control-value" id="creativity-value">50%</span>
        </div>
        <input type="range" id="creativity" class="slider" min="0" max="100" value="50" step="1">
        <div class="slider-bounds"><span>Restrained</span><span>Wild</span></div>
      </div>

      <div class="control-group">
        <div class="control-label-row">
          <label class="field-label" for="quality">Quality</label>
          <span class="control-value" id="quality-value">Balanced</span>
        </div>
        <input type="range" id="quality" class="slider" min="0" max="2" value="1" step="1">
        <div class="slider-bounds"><span>Raw</span><span>Polished</span></div>
      </div>

      <button class="generate-btn" id="generate-btn">&#9654; Generate</button>
      <div class="generate-hint" id="generate-hint" aria-live="assertive"></div>

      <!-- Advanced panel (collapsed by default) -->
      <details class="advanced-panel">
        <summary class="advanced-toggle">Advanced</summary>
        <div class="advanced-content">

          <!-- Model selection -->
          <div class="control-group">
            <label class="field-label" for="gen-model">Generation model</label>
            <select id="gen-model" class="select-input">
              <option value="turbo" selected>Turbo (default)</option>
              <option value="sft">High Quality</option>
              <option value="base">Base</option>
            </select>
          </div>

          <div class="control-group">
            <label class="field-label" for="lm-model">Planning intelligence</label>
            <select id="lm-model" class="select-input">
              <option value="none">None</option>
              <option value="0.6b">Small</option>
              <option value="1.7b" selected>Medium (default)</option>
              <option value="4b">Large</option>
            </select>
          </div>

          <div class="section-divider"></div>

          <!-- VRAM tier & batch size -->
          <div class="control-group">
            <label class="field-label" for="vram-tier">VRAM tier</label>
            <select id="vram-tier" class="select-input">
              <option value="16" selected>≤16GB (default)</option>
              <option value="24">24GB</option>
              <option value="32">32GB+</option>
            </select>
          </div>

          <div class="control-group">
            <label class="field-label" for="batch-size">Batch size</label>
            <input type="number" id="batch-size" class="number-input" value="1" min="1" max="2">
            <p class="batch-note hidden" id="batch-note"></p>
          </div>

          <div class="control-group">
            <label class="field-label" for="audio-format">Audio format</label>
            <select id="audio-format" class="select-input">
              <option value="mp3" selected>MP3 (default)</option>
              <option value="wav">WAV</option>
              <option value="flac">FLAC</option>
            </select>
          </div>

          <div class="section-divider"></div>

          <!-- Raw generation params -->
          <div class="control-group">
            <label class="field-label" for="seed">Seed</label>
            <input type="number" id="seed" class="number-input" placeholder="Random" min="0" max="2147483647" autocomplete="off">
          </div>

          <div class="control-group">
            <label class="field-label" for="scheduler">Scheduler</label>
            <select id="scheduler" class="select-input">
              <option value="euler">Euler</option>
              <option value="dpm">DPM++</option>
              <option value="ddim">DDIM</option>
            </select>
          </div>

          <div class="control-group">
            <div class="control-label-row">
              <label class="field-label" for="inference-steps">Inference steps</label>
              <span class="control-value" id="inference-steps-value">60</span>
            </div>
            <input type="range" id="inference-steps" class="slider" min="10" max="150" value="60" step="5">
            <div class="slider-bounds"><span>10</span><span>150</span></div>
          </div>

          <div class="control-group">
            <div class="control-label-row">
              <label class="field-label" for="guidance-lyric">Guidance scale (lyric)</label>
              <span class="control-value" id="guidance-lyric-value">5.0</span>
            </div>
            <input type="range" id="guidance-lyric" class="slider" min="1" max="15" value="5" step="0.5">
            <div class="slider-bounds"><span>1</span><span>15</span></div>
          </div>

          <div class="control-group">
            <div class="control-label-row">
              <label class="field-label" for="guidance-audio">Guidance scale (audio)</label>
              <span class="control-value" id="guidance-audio-value">4.0</span>
            </div>
            <input type="range" id="guidance-audio" class="slider" min="1" max="15" value="4" step="0.5">
            <div class="slider-bounds"><span>1</span><span>15</span></div>
          </div>

        </div>
      </details>
    </section>

  </main>

  <!-- ===== Output Panel ===== -->
  <footer id="output-panel">
    <div class="output-header">
      <span class="output-title">Output</span>
    </div>

    <!-- State 1: Idle -->
    <div class="output-body" id="output-idle">
      <span class="output-hint">Generated audio will appear here</span>
    </div>

    <!-- State 2: Generating -->
    <div class="output-body hidden" id="output-generating">
      <div class="spinner"></div>
      <span class="output-generating-label">Generating… <span id="generating-timer" class="generating-timer"></span></span>
      <button class="ghost-btn" id="cancel-btn" type="button">Cancel</button>
    </div>

    <!-- State 3: Result cards -->
    <div class="output-cards hidden" id="output-cards"></div>
  </footer>

</div>
<script src="app.js"></script>
</body>
</html>
